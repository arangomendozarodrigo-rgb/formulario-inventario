<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: linear-gradient(135deg, #007BFF, #00C6FF, #e0e0e0);
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        width: 350px;
        text-align: center;
      }
      .container img {
        max-width: 180px;
        margin-bottom: 20px;
      }
      h2 {
        color: #007BFF;
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-top: 12px;
        text-align: left;
        font-weight: bold;
        color: #333;
      }
      input, select {
        width: 100%;
        padding: 10px;
        margin-top: 6px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 14px;
      }
      button {
        margin-top: 20px;
        padding: 12px;
        width: 100%;
        background: #007BFF;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .otros-campos {
        display: none;
        margin-top: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <img src="https://lpalimasur.com/assets/images/logo/LOGO_LATAM.png" alt="Logo LPA">
      <h2>Registro de Inventario</h2>
      <form id="miFormulario">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre" required>

        <label for="operacion">Operación:</label>
        <select id="operacion" name="operacion" required>
          <option value="Ingreso">Ingreso</option>
          <option value="Salida">Salida</option>
        </select>

        <label for="herramienta">Herramienta:</label>
        <input list="listaHerramientas" id="herramienta" name="herramienta" required>
        <datalist id="listaHerramientas"></datalist>

        <label for="cantidad" id="labelCantidad">Cantidad:</label>
        <input type="number" id="cantidad" name="cantidad" min="1" required>

        <div class="otros-campos" id="otrosCampos">
          <label for="nuevoNombre">Nombre nueva herramienta:</label>
          <input type="text" id="nuevoNombre" name="nuevoNombre">

          <label for="cantidadInicial">Cantidad inicial:</label>
          <input type="number" id="cantidadInicial" name="cantidadInicial" min="1">
        </div>

        <button type="submit">Registrar</button>
      </form>
    </div>

    <script>
      const herramientaInput = document.getElementById("herramienta");
      const otrosCampos = document.getElementById("otrosCampos");
      const cantidadInput = document.getElementById("cantidad");
      const labelCantidad = document.getElementById("labelCantidad");

      // URL de tu Web App de Google Script
      const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwUjC9cSUh0tvEvOA2E1315uClW56LppdMrjlblZ8Ha4YQVZ8hFVWVNuuv5-USiqATgDw/exec";

      // Cargar herramientas desde la Web App
      fetch(WEB_APP_URL)
        .then(res => res.json())
        .then(herramientas => {
          let lista = document.getElementById("listaHerramientas");
          herramientas.forEach(h => {
            let option = document.createElement("option");
            option.value = h;
            lista.appendChild(option);
          });
          // Agregar opción "Otros"
          let otros = document.createElement("option");
          otros.value = "Otros";
          lista.appendChild(otros);
        });

      // Mostrar campos para "Otros" y ocultar cantidad normal
      herramientaInput.addEventListener("input", function(){
        if(this.value === "Otros"){
          otrosCampos.style.display = "block";
          cantidadInput.style.display = "none";
          labelCantidad.style.display = "none";
          document.getElementById("cantidadInicial").required = true;
        } else {
          otrosCampos.style.display = "none";
          cantidadInput.style.display = "block";
          labelCantidad.style.display = "block";
          document.getElementById("cantidadInicial").required = false;
        }
      });

      // Enviar formulario
      document.getElementById("miFormulario").addEventListener("submit", function(e){
        e.preventDefault();

        let payload = {};

        if(herramientaInput.value === "Otros"){
          const nuevoNombre = document.getElementById("nuevoNombre").value.trim();
          const cantidadInicial = parseInt(document.getElementById("cantidadInicial").value);

          if(!nuevoNombre || !cantidadInicial){
            alert("Por favor ingresa el nombre y la cantidad inicial de la nueva herramienta.");
            return;
          }

          payload = {
            nombre: this.nombre.value,
            operacion: "Ingreso",
            herramienta: nuevoNombre,
            cantidad: cantidadInicial
          };

        } else {
          const cantidad = parseInt(cantidadInput.value);
          payload = {
            nombre: this.nombre.value,
            operacion: this.operacion.value,
            herramienta: herramientaInput.value,
            cantidad: cantidad
          };
        }

        // Enviar datos a la Web App
        fetch(WEB_APP_URL, {
          method: "POST",
          body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(data => {
          alert("✅ Registro guardado correctamente!");
          this.reset();
          otrosCampos.style.display = "none";
          cantidadInput.style.display = "block";
          labelCantidad.style.display = "block";
        })
        .catch(err => {
          console.error(err);
          alert("❌ Error al guardar. Revisa tu Web App.");
        });
      });
    </script>
  </body>
</html>

